# Prompt para Desenvolvimento do Banco de Dados - Sistema de Gestão para Restaurantes e Bares

## Contexto do Projeto

Desenvolva o esquema de banco de dados para um **Sistema de Gestão Completo para Restaurantes e Bares**, uma plataforma multi-tenant que permite gerenciar múltiplos estabelecimentos gastronômicos de forma independente e segura. O sistema utiliza **Supabase PostgreSQL** com arquitetura multi-tenant baseada em Row Level Security (RLS).

## Arquitetura Multi-Tenant para Estabelecimentos

### Conceitos Fundamentais
- **Isolamento Completo**: Cada estabelecimento opera de forma totalmente independente
- **Segurança por RLS**: Políticas de linha garantem que dados nunca "vazem" entre estabelecimentos
- **Escalabilidade**: Arquitetura preparada para milhares de estabelecimentos simultâneos
- **Flexibilidade**: Diferentes tipos de negócios (restaurantes, bares, lanchonetes, pizzarias)

### Gestão de Estabelecimentos
- **Cadastro Completo**: Nome, CNPJ, tipo de estabelecimento, endereço completo
- **Configurações Personalizáveis**: Horário de funcionamento por dia da semana
- **Planos de Assinatura**: Básico, Premium, Enterprise com funcionalidades diferenciadas
- **Status Operacional**: Controle de estabelecimentos ativos, inativos ou suspensos
- **Capacidade e Serviços**: Número de mesas, aceita delivery, aceita reservas
- **Taxa de Serviço**: Configuração personalizada por estabelecimento

### Sistema de Usuários e Permissões
- **Hierarquia de Funções**: Proprietário, Gerente, Garçom, Cozinheiro, Caixa, Barman
- **Permissões Granulares**: Controle detalhado por módulo (criar, ler, atualizar, deletar)
- **Gestão de Funcionários**: Dados pessoais, salário, data de admissão, status
- **Autenticação Segura**: Integração com Supabase Auth, senhas provisórias
- **Controle de Acesso**: Último login, histórico de atividades

## Módulos Funcionais Detalhados

### 1. Gestão de Ambiente e Mesas

#### Organização Espacial
- **Ambientes Personalizados**: Salão principal, terraço, área VIP, área externa
- **Layout Visual**: Posicionamento de mesas com coordenadas X,Y para interface gráfica
- **Capacidade por Ambiente**: Controle de lotação máxima por área
- **Status Dinâmico**: Disponível, ocupada, reservada, em manutenção

#### Sistema de Mesas
- **Identificação Única**: Numeração personalizada por estabelecimento
- **Características Físicas**: Formato (redonda, quadrada, retangular, balcão), capacidade
- **Status em Tempo Real**: Atualização automática conforme ocupação
- **Observações**: Notas especiais sobre cada mesa

#### Gestão de Reservas
- **Reservas Online**: Integração com sistema de reservas por telefone/site
- **Controle de Horários**: Disponibilidade por data e hora específica
- **Dados do Cliente**: Nome, telefone, email, número de pessoas
- **Status de Reserva**: Confirmada, cancelada, compareceu, não compareceu
- **Notificações**: Lembretes automáticos para clientes e funcionários

### 2. Cardápio e Gestão de Produtos

#### Estrutura do Cardápio
- **Categorias Personalizadas**: Entrada, prato principal, sobremesa, bebidas, etc.
- **Organização Visual**: Ícones, cores e ordem de exibição personalizável
- **Disponibilidade Temporal**: Produtos disponíveis apenas em horários específicos
- **Cardápio Sazonal**: Ativação/desativação de categorias por período

#### Produtos Detalhados
- **Informações Completas**: Nome, descrição detalhada, ingredientes
- **Precificação Flexível**: Preço normal, preço promocional, promoções temporárias
- **Informações Nutricionais**: Calorias, informações para alérgicos
- **Classificações Especiais**: Vegetariano, vegano, sem glúten, sem lactose
- **Tempo de Preparo**: Estimativa para organização da cozinha
- **Galeria de Imagens**: Fotos dos pratos para apresentação

#### Sistema de Variações
- **Tamanhos**: Pequeno, médio, grande com preços diferenciados
- **Sabores**: Múltiplas opções para pizzas, lanches, bebidas
- **Adicionais**: Ingredientes extras com valores específicos
- **Personalizações**: Opções de preparo (mal passado, bem passado, etc.)

#### Combos e Promoções
- **Combos Inteligentes**: Agrupamento de produtos com desconto
- **Promoções Temporais**: Happy hour, desconto em dias específicos
- **Promoções Condicionais**: Desconto por quantidade, fidelidade
- **Validação Automática**: Aplicação automática de descontos elegíveis

### 3. Sistema de Pedidos e Comandas

#### Tipos de Serviço
- **Atendimento Local**: Mesas do restaurante/bar
- **Balcão**: Pedidos para consumo no balcão
- **Delivery**: Entrega com endereço e taxa de entrega
- **Retirada**: Pedidos para buscar no estabelecimento

#### Fluxo de Comandas
- **Abertura Inteligente**: Numeração automática sequencial por dia
- **Atribuição de Garçom**: Responsável pela mesa/pedido
- **Status Detalhado**: Aberta → Enviada Cozinha → Preparando → Pronta → Entregue → Paga
- **Tempo Real**: Atualizações instantâneas para toda a equipe
- **Histórico Completo**: Rastreamento de todas as alterações

#### Gestão de Itens
- **Adição Dinâmica**: Produtos adicionados durante o atendimento
- **Modificações**: Alteração de quantidade, observações especiais
- **Cancelamentos**: Controle de itens cancelados com motivo
- **Status Individual**: Cada item tem seu próprio status de preparo
- **Observações Especiais**: Instruções para cozinha/bar

#### Cálculos Automáticos
- **Subtotal Dinâmico**: Atualização automática conforme adição de itens
- **Taxa de Serviço**: Aplicação automática conforme configuração
- **Taxa de Entrega**: Para pedidos delivery
- **Descontos**: Aplicação de cupons, promoções, cortesias
- **Total Final**: Cálculo completo com todos os ajustes

### 4. Gestão Completa de Estoque

#### Cadastro de Fornecedores
- **Dados Completos**: CNPJ/CPF, contatos, endereço
- **Condições Comerciais**: Prazo de pagamento, condições especiais
- **Histórico de Compras**: Relacionamento comercial detalhado
- **Avaliação de Fornecedores**: Rating baseado em pontualidade e qualidade

#### Categorização Inteligente
- **Categorias Customizáveis**: Carnes, bebidas, descartáveis, limpeza, etc.
- **Identificação Visual**: Cores para organização rápida
- **Subcategorias**: Organização hierárquica detalhada

#### Controle de Produtos
- **Código de Barras**: Integração com leitores para agilidade
- **Múltiplas Unidades**: kg, litros, unidades, gramas, caixas
- **Localização Física**: Onde cada item está armazenado
- **Controle de Validade**: Especial para produtos perecíveis
- **Fornecedor Preferencial**: Relacionamento item-fornecedor

#### Movimentações Detalhadas
- **Tipos de Movimento**: Entrada, saída, ajuste, perda, transferência
- **Rastreabilidade**: Documento de referência (nota fiscal, requisição)
- **Responsável**: Funcionário que executou a movimentação
- **Motivos Detalhados**: Venda, perda, vencimento, quebra, amostra grátis
- **Custo por Movimentação**: Controle financeiro detalhado

#### Alertas Inteligentes
- **Estoque Mínimo**: Notificações automáticas para reposição
- **Produtos Vencendo**: Alertas de validade próxima
- **Ruptura de Estoque**: Produtos zerados que afetam vendas
- **Análise de Giro**: Produtos com baixa rotatividade

#### Receitas e Composição
- **Fichas Técnicas**: Quantidade exata de cada ingrediente por prato
- **Custo por Prato**: Cálculo automático baseado no estoque
- **Margem de Lucro**: Análise de rentabilidade por produto
- **Simulação de Preços**: Impact de alterações de custo no preço final

### 5. Sistema Financeiro Avançado

#### Formas de Pagamento
- **Pagamentos Tradicionais**: Dinheiro, cartão débito/crédito
- **Pagamentos Digitais**: PIX, carteiras digitais, vale-refeição
- **Taxas Personalizadas**: Taxa por operadora de cartão
- **Prazo de Recebimento**: Controle de D+0, D+1, D+30 por modalidade

#### Sessões de Caixa
- **Abertura Controlada**: Valor inicial, funcionário responsável
- **Movimentações**: Vendas, sangrias, reforços, cancelamentos
- **Fechamento Detalhado**: Conferência de valores por forma de pagamento
- **Relatório de Divergências**: Identificação de diferenças no fechamento
- **Múltiplos Caixas**: Suporte a vários caixas simultâneos

#### Controle de Pagamentos
- **Divisão de Contas**: Rateio entre pessoas ou formas de pagamento
- **Pagamentos Parciais**: Múltiplas formas para uma mesma comanda
- **Troco Inteligente**: Cálculo automático para pagamentos em dinheiro
- **Comprovantes Digitais**: Armazenamento de comprovantes de cartão/PIX

#### Movimentações Financeiras
- **Sangrias**: Retirada de dinheiro do caixa com justificativa
- **Reforços**: Entrada adicional de dinheiro
- **Cancelamentos**: Estorno de vendas com motivo
- **Despesas Operacionais**: Registro de gastos do dia a dia

### 6. Relatórios e Business Intelligence

#### Dashboards em Tempo Real
- **Vendas do Dia**: Faturamento atual, meta do dia, comparativo
- **Comandas Ativas**: Quantos pedidos em andamento
- **Produtos Mais Vendidos**: Ranking em tempo real
- **Ocupação de Mesas**: Status visual do salão

#### Relatórios Gerenciais
- **Faturamento Detalhado**: Por período, forma de pagamento, funcionário
- **Análise de Produtos**: Ranking de vendas, margem de lucro, sazonalidade
- **Performance de Funcionários**: Vendas por garçom, tempo médio de atendimento
- **Análise de Clientes**: Frequência, ticket médio, preferências

#### Controles Operacionais
- **Tempo de Preparo**: Análise de eficiência da cozinha
- **Desperdício**: Controle de perdas e cancelamentos
- **Ocupação**: Taxa de ocupação de mesas por período
- **Reservas**: Taxa de no-show, antecedência média

#### Análises Financeiras
- **DRE Simplificado**: Receitas, custos, margem de contribuição
- **Fluxo de Caixa**: Entrada e saída por período
- **Análise de Custos**: CMV (Custo da Mercadoria Vendida)
- **Projeções**: Tendências baseadas em histórico

### 7. Funcionalidades Especiais para Estabelecimentos

#### Gestão de Eventos
- **Reservas Especiais**: Aniversários, confraternizações, eventos corporativos
- **Cardápios Especiais**: Menus específicos para eventos
- **Controle de Capacidade**: Gestão de lotação para eventos
- **Pacotes Fechados**: Valores fixos por pessoa para eventos

#### Sistema de Fidelidade
- **Cadastro de Clientes**: Dados, preferências, histórico de consumo
- **Programa de Pontos**: Acúmulo e resgate de benefícios
- **Promoções Dirigidas**: Ofertas personalizadas por perfil
- **Aniversariantes**: Campanhas especiais para datas especiais

#### Integração com Delivery
- **Múltiplas Plataformas**: iFood, Uber Eats, Rappi
- **Gestão Unificada**: Todos os pedidos em um só lugar
- **Controle de Comissões**: Taxa por plataforma
- **Tempo de Preparo**: Estimativas precisas para entregadores

#### Controle de Qualidade
- **Feedback de Clientes**: Avaliações por prato/atendimento
- **Controle de Temperatura**: Para produtos que exigem refrigeração
- **Rastreabilidade**: Origem dos ingredientes, lote de produtos
- **Certificações**: Controle de validade de alvarás, licenças

## Requisitos Técnicos de Performance

### Otimizações de Banco
- **Índices Estratégicos**: Para consultas frequentes (comandas do dia, estoque baixo)
- **Particionamento**: Dados históricos por data para consultas rápidas
- **Cache Inteligente**: Cardápio, configurações frequentemente acessadas
- **Compressão**: Dados históricos para economia de espaço

### Auditoria e Compliance
- **Log Completo**: Todas as operações financeiras rastreadas
- **Backup Automático**: Cópias de segurança regulares e testadas
- **Retenção de Dados**: Políticas de guarda conforme legislação
- **Relatórios Fiscais**: Preparação para integração com sistemas contábeis

### Segurança Avançada
- **Criptografia**: Dados sensíveis protegidos em repouso e em trânsito
- **Controle de Acesso**: Autenticação forte e autorização granular
- **Monitoramento**: Detecção de atividades suspeitas
- **Recuperação**: Planos de contingência para falhas

## Considerações para Diferentes Tipos de Estabelecimento

### Restaurantes Tradicionais
- Foco em tempo de preparo e organização de cozinha
- Controle rigoroso de receitas e custos
- Gestão de reservas e eventos especiais

### Bares e Pubs
- Ênfase em bebidas e porções
- Controle de estoque de bebidas alcoólicas
- Gestão de música e entretenimento

### Lanchonetes e Fast Food
- Rapidez no atendimento
- Controle de produtos pré-preparados
- Foco em delivery e retirada

### Pizzarias
- Gestão de sabores e tamanhos
- Controle de ingredientes por pizza
- Sistema de delivery otimizado

Este sistema oferece uma solução completa e escalável para qualquer tipo de estabelecimento gastronômico, garantindo eficiência operacional, controle financeiro rigoroso e excelente experiência para clientes e funcionários.